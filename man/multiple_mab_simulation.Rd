% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/multiple_mab_simulation.R
\name{multiple_mab_simulation}
\alias{multiple_mab_simulation}
\title{Conducts Multiple Multi-Arm Bandit Trials with Adaptive Inference in Parallel}
\usage{
multiple_mab_simulation(
  data,
  assignment_method,
  algorithm,
  conditions,
  prior_periods,
  perfect_assignment,
  whole_experiment,
  blocking,
  data_cols,
  times,
  seeds,
  control_augment = 0,
  time_unit = NULL,
  period_length = NULL,
  block_cols = NULL,
  verbose = FALSE,
  keep_data = FALSE
)
}
\arguments{
\item{data}{A data frame, tibble or data.table that provides the input data for the trial.}

\item{assignment_method}{String; "Date", "Batch" or "Individual" to define the assignment into treatment waves.}

\item{algorithm}{A string specifying the MAB algorithm to use. Options are "Thompson" or "UCB1".}

\item{conditions}{Named Character vector containing treatment conditions.
Control condition, must be named "Control" when 'control_augment' > 0.}

\item{prior_periods}{Numeric; number of previous periods to use in the treatment assignment model
or specify string "All" to use all previous periods.}

\item{perfect_assignment}{Logical; if TRUE, assumes perfect information for treatment assignment
(i.e., all outcomes are observed regardless of the date).
If FALSE, hides outcomes not yet theoretically observed, based
on the dates treatments would have been assigned for each wave.}

\item{whole_experiment}{Logical; if TRUE, uses all past experimental data for imputing outcomes.
If FALSE, uses only data available up to the current period.}

\item{blocking}{Logical; Whether or not to use treatment blocking.}

\item{data_cols}{Named Character vector containing the names of columns in data as strings:
\itemize{
\item \code{id_col}: Column in data, contains unique id as a key.
\item \code{success_col}: Column in data; Binary successes from original experiment.
\item \code{condition_col}: Column in data; Original Treatment condition for each observation.
\item \code{date_col}: Column in data, contains original date of event/trial; only ncessary when assigning by 'Date'.
\item \code{month_col}: Column in data, contains month of treatment; only necessary when time_unit = 'Month'.
\item \code{success_date_col}: Column in data, contains original dates each success occured; only necessary when 'perfect_assignment' = FALSE.
\item \code{assignment_date_col}: Column in data, contains original dates treatments are assigned to observations; only necessary when 'perfect_assignment' = FALSE.
Used to simulate imperfect information on part of researchers conducting an adaptive trial.
}}

\item{times}{Integer; number of simulations to conduct.}

\item{seeds}{Integer vector of \code{length(times)} containing valid seeds to define random state for each trial.}

\item{control_augment}{Number \eqn{\in} [0,1]; Proportion of each wave guaranteed to get "Control" treatment.
Default is 0.}

\item{time_unit}{A string specifying the unit of time for assigning periods when 'assignment_method` is 'date'.
Acceptable values are "Day", "Week", or "Month".}

\item{period_length}{Numeric; length of each treatment period.
If assignment method is "Date", this refers to the
length of periods by your specified \code{time_unit} (i.e., if "Day", 10 would be 10 days).
If assignment methods is "Batch", this refers to the number of people in each batch.}

\item{block_cols}{Character Vector of variables to block by.}

\item{verbose}{Logical; Toggles progress bar from \code{\link[furrr:future_map]{furrr::future_map()}}.}

\item{keep_data}{Logical; Whether or not to keep the final data from each trial. Recommended FALSE for large datasets
.}
}
\value{
\code{multiple.mab} class object, which is a named list containing:
\itemize{
\item \verb{final_data_nest:} Data.frame containing a nested data.frame with the final data from each trial
\item \verb{bandits:} Data.frame containing the Thompson/UCB1 statistics across all treatments, periods, and trials
\item \verb{estimates:} Data.frame containing the AIPW statistics across all treatments, and trials
\item \code{settings}: A list of the configuration settings used in the trial.
}
}
\description{
Repeated Multi-Arm Bandit Simulations with the same settings in different
random states. Allows for parallel processing using \code{\link[future:plan]{future::plan()}} and \code{\link[furrr:future_map]{furrr::future_map()}}.
}
\examples{
# Multiple_mab_simulation() is a useful tool for running multiple trials
# using the same configuration settings, in different random states
data(tanf)
# Subsetting to make the example faster
tanf <- tanf[1:50, ]

# The seeds passed must be integers, so it is highly recommended to create them
# before using `sample.int()`
set.seed(1)
seeds <- sample.int(10000, 5)
conditions <- c("no_letter", "open_appt", "specific_appt")

# For this example, period_length is set a large interval and
# times is low to keep run time short.
start <- proc.time()
x <- multiple_mab_simulation(
  data = tanf,
  assignment_method = "Batch",
  period_length = 25,
  whole_experiment = TRUE,
  blocking = FALSE,
  perfect_assignment = TRUE,
  algorithm = "Thompson",
  prior_periods = "All",
  control_augment = 0,
  conditions = conditions,
  data_cols = c(
    condition_col = "condition",
    id_col = "id",
    success_col = "success"
  ),
  verbose = FALSE, times = 5, seeds = seeds, keep_data = TRUE
)
seq_time <- proc.time() - start
print(x)

# Its Recommenced to set keep_data at FALSE unless necessary to avoid
# the output from taking up to much memory
# Keep TRUE
object.size(x)
x$final_data_nest <- NULL
# Size if Keep was FALSE
object.size(x)

# multiple_mab_simulation() is implemented using furrr::future_map()
# so you can also run simulations in parallel using futures.
# Simply run your preferred plan and number of cores before multiple_mab_simulation.
# Like: 
\dontrun{

  future::plan("plan", workers = n)
  multiple_mab_simulation(data = tanf,
                          assignment_method = "Batch",
                          period_length = 25,
                          whole_experiment = TRUE,
                          blocking = FALSE,
                          perfect_assignment = TRUE,
                          algorithm = "Thompson",
                          prior_periods = "All",
                          control_augment = 0,
                          conditions = conditions,
                          data_cols = c(
                            condition_col = "condition",
                            id_col = "id",
                            success_col = "success"
                          ),
                          verbose = FALSE, times = 5, seeds = seeds, keep_data = TRUE
  )
  future::plan("sequential")
}
# If your on Windows plan needs to be multisession
# If your on Unix (MacOS/Linux) you can use multicore or multisession
# If your running the code on a high performance cluster, look into
# using the future.batchtools API for whichever scheduler is used

# Check the future and furrr documentation for more details on possible options
}
\seealso{
\itemize{
\item \code{\link[=run_mab_trial]{run_mab_trial()}}
\item \code{\link[=get_adaptive_aipw]{get_adaptive_aipw()}}
\item \code{\link[=check_args]{check_args()}}
\item \code{\link[=single_mab_simulation]{single_mab_simulation()}}
\item \code{\link[=mab_simulation]{mab_simulation()}}
\item \code{\link[=pre_mab_simulation]{pre_mab_simulation()}}
\item \code{\link[furrr:future_map]{furrr::future_map()}}
\item \code{\link[future:plan]{future::plan()}}
}
}
